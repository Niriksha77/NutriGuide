<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Child Profile - Nutriguide</title>
    <link rel="stylesheet" href="child.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>

<div class="container mt-5">
    <div class="child-profile">
        <h2 class="text-center">Child Profile</h2>

        <!-- Form -->
        <form action="connect.php" method="POST" id="childForm">

            <div class="mb-3">
                <label for="childName" class="form-label">Child's Name:</label>
                <input type="text" class="form-control" id="childName" name="name" placeholder="Enter child's name" required>
            </div>

            <div class="mb-3">
                <label for="childAge" class="form-label">Age:</label>
                <input type="number" class="form-control" id="age" name="age" placeholder="Enter age (1 to 15)" min="1" max="15" required>
            </div>

            <div class="mb-3">
                <label for="childGender" class="form-label">Gender:</label>
                <select class="form-select" id="childGender" name="gender" required>
                    <option name="s" value="">Select Gender</option>
                    <option name="gender" value="m">Male</option>
                    <option name="gender" value="f">Female</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="childHeight" class="form-label">Height (cm):</label>
                <input type="number" class="form-control" id="height" name="height" placeholder="Enter Height" min="1" required>
            </div>

            <div class="mb-3">
                <label for="childWeight" class="form-label">Weight (kg):</label>
                <input type="number" class="form-control" id="weight" name="weight" placeholder="Enter weight" min="2" required>
            </div>

            <div class="mb-3">
                <label for="parentPhone" class="form-label">Phone Number:</label>
                <input type="tel" class="form-control" id="parentPhone" name="phone" placeholder="Enter phone number" required>
            </div>

            <div class="navigation-buttons">
                <!-- Save and Next buttons -->
                <div class="text-center p-3 m-4">
                    <button type="submit" class="btn btn-primary w-25">Save</button>
                    <button type="button" onclick="fetchDataAndCalculateBMI()" class="btn btn-primary w-25">Next</button>
                </div>
            
                <!-- Back button -->
                <div class="text-end">
                    <a href="SL.html" class="btn btn-dark">Back</a>
                </div>
            </div>
            
        </form>
    </div>
</div>

<script>
    function calculateBMI(heightCm, weight) {
        var heightM = heightCm / 100;
        return weight / (heightM * heightM);
    }

    function redirectToDietChart(age, height, weight) {
        var bmi = calculateBMI(height, weight);
        var category = "";
        var redirectUrl = "";

        if (age >= 1 && age <= 3) {
            if (bmi < 14) {
                category = "Underweight";
                redirectUrl = "s1.html";
            } else if (bmi >= 14 && bmi <= 17) {
                category = "Normal weight";
                redirectUrl = "n1.html";
            } else if (bmi > 17) {
                category = "Overweight";
                redirectUrl = "o1.html";
            }
        } else if (age >= 4 && age <= 6) {
            if (bmi < 14.5) {
                category = "Underweight";
                redirectUrl = "s2.html";
            } else if (bmi >= 14.5 && bmi <= 17.5) {
                category = "Normal weight";
                redirectUrl = "n2.html";
            } else if (bmi > 17.5) {
                category = "Overweight";
                redirectUrl = "o2.html";
            }
        } else if (age >= 7 && age <= 9) {
            if (bmi < 15) {
                category = "Underweight";
                redirectUrl = "s3.html";
            } else if (bmi >= 15 && bmi <= 18) {
                category = "Normal weight";
                redirectUrl = "n3.html";
            } else if (bmi > 18) {
                category = "Overweight";
                redirectUrl = "o3.html";
            }
        } else if (age >= 10 && age <= 12) {
            if (bmi < 16) {
                category = "Underweight";
                redirectUrl = "s4.html";
            } else if (bmi >= 16 && bmi <= 19) {
                category = "Normal weight";
                redirectUrl = "n4.html";
            } else if (bmi > 19) {
                category = "Overweight";
                redirectUrl = "o4.html";
            }
        } else if (age >= 13 && age <= 15) {
            if (bmi < 17) {
                category = "Underweight";
                redirectUrl = "s5.html";
            } else if (bmi >= 17 && bmi <= 22) {
                category = "Normal weight";
                redirectUrl = "n5.html";
            } else if (bmi > 22) {
                category = "Overweight";
                redirectUrl = "o5.html";
            }
        } else {
            alert("Age out of range. Please enter an age between 1 and 15.");
            return;
        }

        alert("Redirecting to your diet chart");
        window.location.href = redirectUrl;
    }

    function fetchDataAndCalculateBMI() {
        var phone = document.getElementById('parentPhone').value; // Get phone number from input field

        // Fetch data from the database
        fetch(`fetch_data.php?phone=${phone}`)
            .then(response => response.json())
            .then(data => {
                if (data.age && data.height && data.weight) {
                    // Calculate BMI and redirect
                    redirectToDietChart(data.age, data.height, data.weight);
                } else {
                    alert("No data found for the provided phone number.");
                }
            })
            .catch(error => {
                console.error("Error fetching data:", error);
                alert("An error occurred while fetching data.");
            });
    }
</script>
</body>
</html>